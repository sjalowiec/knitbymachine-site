<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Skill Builder Admin - Knit by Machine</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background-color: #f6f7f8;
      padding: 2rem;
      line-height: 1.6;
      color: #333;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      color: #52682D;
      margin-bottom: 0.5rem;
      font-size: 2rem;
    }

    h2 {
      color: #52682D;
      margin: 2rem 0 1rem;
      font-size: 1.5rem;
      border-bottom: 2px solid #52682D;
      padding-bottom: 0.5rem;
    }

    h3 {
      color: #738C52;
      margin: 1.5rem 0 0.75rem;
      font-size: 1.2rem;
    }

    .subtitle {
      color: #738C52;
      margin-bottom: 2rem;
      font-size: 1.1rem;
    }

    .card {
      background: white;
      border-radius: 8px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 8px rgba(82, 104, 45, 0.1);
    }

    .module-card {
      background: #fafbfa;
      border: 2px solid #e5e8e0;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      position: relative;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    label {
      display: block;
      color: #52682D;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    input[type="text"],
    textarea {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #e5e8e0;
      border-radius: 6px;
      font-size: 1rem;
      font-family: inherit;
      transition: border-color 0.2s;
    }

    input[type="text"]:focus,
    textarea:focus {
      outline: none;
      border-color: #52682D;
    }

    textarea {
      resize: vertical;
      min-height: 80px;
      font-family: 'Courier New', monospace;
    }

    textarea.large {
      min-height: 120px;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background-color: #52682D;
      color: white;
    }

    .btn-primary:hover {
      background-color: #3e5023;
    }

    .btn-secondary {
      background-color: #738C52;
      color: white;
    }

    .btn-secondary:hover {
      background-color: #5f7343;
    }

    .btn-danger {
      background-color: #dc3545;
      color: white;
    }

    .btn-danger:hover {
      background-color: #c82333;
    }

    .btn-small {
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
    }

    .btn-group {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
    }

    .remove-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
    }

    .checklist-items {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .checklist-item {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .checklist-item input {
      flex: 1;
    }

    .json-output {
      background-color: #f6f7f8;
      border: 2px solid #52682D;
      border-radius: 6px;
      padding: 1.5rem;
      margin-top: 1rem;
      overflow-x: auto;
    }

    .json-output pre {
      margin: 0;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      color: #333;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .module-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .optional-label {
      color: #738C52;
      font-weight: normal;
      font-size: 0.9rem;
      margin-left: 0.5rem;
    }

    .micro-responses {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 1rem;
    }

    @media (max-width: 768px) {
      body {
        padding: 1rem;
      }

      .card {
        padding: 1.5rem;
      }

      .micro-responses {
        grid-template-columns: 1fr;
      }

      .btn-group {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Skill Builder Admin</h1>
    <p class="subtitle">Build and export your Skill Builder JSON</p>

    <!-- Main Info -->
    <div class="card">
      <h2>Basic Information</h2>
      
      <div class="form-group">
        <label for="title">Skill Builder Title</label>
        <input type="text" id="title" placeholder="Enter title">
      </div>

      <div class="form-group">
        <label for="description">Short Description</label>
        <textarea id="description" placeholder="Brief overview of the skill builder"></textarea>
      </div>

      <div class="form-group">
        <label for="tagline">Tagline</label>
        <input type="text" id="tagline" placeholder="Catchy one-liner">
      </div>
    </div>

    <!-- Prep Checklist -->
    <div class="card">
      <h2>Prep Checklist</h2>
      <div id="checklistContainer" class="checklist-items">
        <div class="checklist-item">
          <input type="text" placeholder="Checklist item">
          <button class="btn btn-danger btn-small" onclick="removeChecklistItem(this)">Remove</button>
        </div>
      </div>
      <button class="btn btn-secondary btn-small" onclick="addChecklistItem()" style="margin-top: 1rem;">Add Item</button>
    </div>

    <!-- Modules -->
    <div class="card">
      <h2>Modules (Exercises)</h2>
      <div id="modulesContainer"></div>
      <button class="btn btn-secondary" onclick="addModule()">Add Module</button>
    </div>

    <!-- Reflection -->
    <div class="card">
      <h2>Reflection ("Did you get the point?")</h2>
      
      <div class="form-group">
        <label for="reflectionQuestion">Reflection Question</label>
        <textarea id="reflectionQuestion" placeholder="Final reflection question"></textarea>
      </div>

      <div class="form-group">
        <label>Responses</label>
        <div class="micro-responses">
          <div>
            <label for="reflectionYes">If "Yes"</label>
            <textarea id="reflectionYes" placeholder="Response for yes"></textarea>
          </div>
          <div>
            <label for="reflectionNo">If "No"</label>
            <textarea id="reflectionNo" placeholder="Response for no"></textarea>
          </div>
        </div>
      </div>
    </div>

    <!-- Actions -->
    <div class="btn-group">
      <button class="btn btn-primary" onclick="generateJSON()">Generate JSON</button>
      <button class="btn btn-secondary" onclick="downloadJSON()" id="downloadBtn" style="display: none;">Download JSON</button>
    </div>

    <!-- JSON Output -->
    <div id="jsonOutputContainer" style="display: none;">
      <div class="card">
        <h2>Generated JSON</h2>
        <div class="json-output">
          <pre id="jsonOutput"></pre>
        </div>
      </div>
    </div>
  </div>

  <script>
    let moduleCount = 0;
    let generatedJSON = null;

    // Initialize with one module
    window.addEventListener('DOMContentLoaded', () => {
      addModule();
    });

    function addChecklistItem() {
      const container = document.getElementById('checklistContainer');
      const item = document.createElement('div');
      item.className = 'checklist-item';
      item.innerHTML = `
        <input type="text" placeholder="Checklist item">
        <button class="btn btn-danger btn-small" onclick="removeChecklistItem(this)">Remove</button>
      `;
      container.appendChild(item);
    }

    function removeChecklistItem(btn) {
      btn.parentElement.remove();
    }

    function addModule() {
      moduleCount++;
      const container = document.getElementById('modulesContainer');
      const module = document.createElement('div');
      module.className = 'module-card';
      module.dataset.moduleId = moduleCount;
      
      module.innerHTML = `
        <div class="module-header">
          <h3>Module ${moduleCount}</h3>
          <button class="btn btn-danger btn-small remove-btn" onclick="removeModule(this)">Remove Module</button>
        </div>

        <div class="form-group">
          <label>Title</label>
          <input type="text" class="module-title" placeholder="Module title">
        </div>

        <div class="form-group">
          <label>HTML Description</label>
          <textarea class="module-description large" placeholder="Enter HTML description (supports HTML tags)"></textarea>
        </div>

        <div class="form-group">
          <label>Media Link <span class="optional-label">(optional)</span></label>
          <input type="text" class="module-media" placeholder="Video or GIF URL">
        </div>

        <div class="form-group">
          <label>Micro-Interaction Question <span class="optional-label">(optional yes/no question)</span></label>
          <input type="text" class="module-question" placeholder="e.g., Did you try this?">
        </div>

        <div class="form-group">
          <label>Micro-Interaction Responses <span class="optional-label">(optional)</span></label>
          <div class="micro-responses">
            <div>
              <label>If "Yes"</label>
              <textarea class="module-yes" placeholder="Response for yes"></textarea>
            </div>
            <div>
              <label>If "No"</label>
              <textarea class="module-no" placeholder="Response for no"></textarea>
            </div>
          </div>
        </div>
      `;
      
      container.appendChild(module);
    }

    function removeModule(btn) {
      btn.closest('.module-card').remove();
    }

    function generateSlug(title) {
      return title
        .toLowerCase()
        .trim()
        .replace(/[^\w\s-]/g, '')
        .replace(/[\s_-]+/g, '-')
        .replace(/^-+|-+$/g, '');
    }

    function generateJSON() {
      const title = document.getElementById('title').value.trim();
      const description = document.getElementById('description').value.trim();
      const tagline = document.getElementById('tagline').value.trim();

      if (!title) {
        alert('Please enter a title');
        return;
      }

      // Get checklist items
      const checklistInputs = document.querySelectorAll('#checklistContainer input');
      const prepChecklist = Array.from(checklistInputs)
        .map(input => input.value.trim())
        .filter(item => item);

      // Get modules
      const moduleCards = document.querySelectorAll('.module-card');
      const modules = Array.from(moduleCards).map(card => {
        const moduleTitle = card.querySelector('.module-title').value.trim();
        const htmlDescription = card.querySelector('.module-description').value.trim();
        const media = card.querySelector('.module-media').value.trim();
        const microQuestion = card.querySelector('.module-question').value.trim();
        const microYes = card.querySelector('.module-yes').value.trim();
        const microNo = card.querySelector('.module-no').value.trim();

        const module = {
          title: moduleTitle,
          htmlDescription: htmlDescription,
          media: media || "",
          microQuestion: microQuestion || "",
          microResponses: {
            yes: microYes || "",
            no: microNo || ""
          }
        };

        return module;
      });

      // Get reflection
      const reflectionQuestion = document.getElementById('reflectionQuestion').value.trim();
      const reflectionYes = document.getElementById('reflectionYes').value.trim();
      const reflectionNo = document.getElementById('reflectionNo').value.trim();

      const reflection = {
        question: reflectionQuestion,
        responses: {
          yes: reflectionYes,
          no: reflectionNo
        }
      };

      // Build final JSON
      generatedJSON = {
        title,
        description,
        tagline,
        prepChecklist,
        modules,
        reflection
      };

      // Display JSON
      const jsonOutput = document.getElementById('jsonOutput');
      jsonOutput.textContent = JSON.stringify(generatedJSON, null, 2);
      
      document.getElementById('jsonOutputContainer').style.display = 'block';
      document.getElementById('downloadBtn').style.display = 'inline-block';

      // Scroll to output
      document.getElementById('jsonOutputContainer').scrollIntoView({ behavior: 'smooth' });
    }

    function downloadJSON() {
      if (!generatedJSON) {
        alert('Please generate JSON first');
        return;
      }

      const slug = generateSlug(generatedJSON.title);
      const filename = `skillbuilder-${slug}.json`;
      const jsonString = JSON.stringify(generatedJSON, null, 2);
      
      const blob = new Blob([jsonString], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
